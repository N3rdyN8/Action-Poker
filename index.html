<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

<title>Action Poker</title>

<!-- PWA -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0b6623">

<!-- Icons -->
<link rel="icon" href="icon-192.png">
<link rel="apple-touch-icon" href="apple-touch-icon.png">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<!-- iOS Splash Screens -->
<link rel="apple-touch-startup-image" href="splash-1170x2532.png" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3)">
<link rel="apple-touch-startup-image" href="splash-1125x2436.png" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3)">
<link rel="apple-touch-startup-image" href="splash-1242x2688.png" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3)">
<link rel="apple-touch-startup-image" href="splash-828x1792.png" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2)">
<link rel="apple-touch-startup-image" href="splash-1242x2208.png" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3)">
<link rel="apple-touch-startup-image" href="splash-750x1334.png" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)">

<style>
:root {
  --green: #0b6623;
  --gold: #f5c542;
  --blue: #2196f3;
  --red: #e53935;
  --orange: #fb8c00;
}

body {
  background: radial-gradient(circle at top, #138a3a, var(--green));
  font-family: system-ui, sans-serif;
  color: white;
  padding: 12px;
  margin: 0;
}

header {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  margin-bottom: 8px;
}

header img {
  width: 32px;
  height: 32px;
}

h1 {
  margin: 0;
  font-size: 22px;
}

#street {
  text-align: center;
  font-size: 18px;
}

#pot {
  background: linear-gradient(#ffd54f, var(--gold));
  color: black;
  text-align: center;
  font-size: 22px;
  padding: 12px;
  border-radius: 14px;
  margin: 10px 0;
  font-weight: bold;
}

.player {
  background: white;
  color: black;
  padding: 12px;
  border-radius: 14px;
  margin-bottom: 10px;
}

.active { outline: 3px solid var(--blue); }
.folded { opacity: 0.45; text-decoration: line-through; }

.badge {
  background: black;
  color: white;
  padding: 2px 6px;
  border-radius: 6px;
  font-size: 11px;
  margin-left: 4px;
}

.row {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 8px;
  margin-top: 8px;
}

button {
  padding: 12px;
  border: none;
  border-radius: 12px;
  font-size: 15px;
  font-weight: 600;
  cursor: pointer;
}

.check { background: #9e9e9e; color: white; }
.raise { background: var(--orange); color: white; }
.fold  { background: var(--red); color: white; }

.add, .award, .next, .reset {
  width: 100%;
  background: black;
  color: white;
  margin-top: 8px;
}

.profit {
  text-align: center;
  margin-top: 12px;
}

.positive { color: #7CFF8A; }
.negative { color: #FF6B6B; }
</style>
</head>

<body>

<header>
  <img src="icon-192.png" alt="Spade">
  <h1>Action Poker</h1>
</header>

<button class="add" onclick="addPlayer()">‚ûï Add Player</button>
<button class="reset" onclick="resetSession()">‚ôª Reset Session</button>

<div id="street">Pre-Flop</div>
<div id="pot">Pot: $0</div>

<div id="players"></div>

<button class="award" onclick="awardPot()">üèÜ Award Pot</button>
<button class="next" onclick="nextHand()">‚û° Next Hand</button>

<div id="profit" class="profit"></div>

<script>
let players = [];
let pot = 0;
let current = 0;
let highestBet = 0;
let dealer = 0;

const streets = ["Pre-Flop", "Flop", "Turn", "River"];
let streetIndex = 0;

const SB = 5;
const BB = 10;

function addPlayer() {
  const name = prompt("Player name:");
  if (!name) return;

  const buyIn = +prompt("Buy-in amount:");
  if (!buyIn) return;

  players.push({
    name,
    stack: buyIn,
    buyIn,
    bet: 0,
    folded: false,
    acted: false,
    allIn: false
  });

  if (players.length === 2) startHand();
  render();
}

function startHand() {
  pot = 0;
  streetIndex = 0;
  highestBet = 0;

  players.forEach(p => {
    p.bet = 0;
    p.folded = false;
    p.acted = false;
    p.allIn = false;
  });

  postBlinds();
}

function smallBlind() { return (dealer + 1) % players.length; }
function bigBlind() { return (dealer + 2) % players.length; }

function postBlinds() {
  postBlind(smallBlind(), SB);
  postBlind(bigBlind(), BB);
  highestBet = BB;
  current = (dealer + 3) % players.length;
}

function postBlind(i, amt) {
  const p = players[i];
  const blind = Math.min(amt, p.stack);
  p.stack -= blind;
  p.bet += blind;
  pot += blind;
  if (p.stack === 0) p.allIn = true;
}

function checkCall(i) {
  if (i !== current) return;
  const p = players[i];
  const needed = highestBet - p.bet;
  const call = Math.min(needed, p.stack);
  p.stack -= call;
  p.bet += call;
  pot += call;
  if (p.stack === 0) p.allIn = true;
  p.acted = true;
  nextTurn();
}

function raiseBet(i) {
  if (i !== current) return;
  const p = players[i];
  let target = +prompt("Raise TO:");
  if (!target || target <= highestBet) return;
  const max = p.bet + p.stack;
  if (target > max) target = max;
  const diff = target - p.bet;
  p.stack -= diff;
  p.bet = target;
  pot += diff;
  highestBet = target;
  if (p.stack === 0) p.allIn = true;
  players.forEach(pl => pl.acted = false);
  p.acted = true;
  nextTurn();
}

function fold(i) {
  if (i !== current) return;
  players[i].folded = true;
  players[i].acted = true;
  nextTurn();
}

function nextTurn() {
  if (bettingComplete()) {
    advanceStreet();
    return;
  }
  do {
    current = (current + 1) % players.length;
  } while (players[current].folded || players[current].allIn);
  render();
}

function bettingComplete() {
  return players.every(p =>
    p.folded || p.allIn || (p.acted && p.bet === highestBet)
  );
}

function advanceStreet() {
  if (streetIndex < 3) {
    streetIndex++;
    resetBets();
  }
  render();
}

function resetBets() {
  highestBet = 0;
  players.forEach(p => {
    p.bet = 0;
    p.acted = false;
  });
  current = firstActive();
}

function firstActive() {
  for (let i = 0; i < players.length; i++)
    if (!players[i].folded && !players[i].allIn) return i;
  return 0;
}

function awardPot() {
  if (!pot) return;
  const names = players.filter(p => !p.folded).map(p => p.name).join("\n");
  const winner = prompt("Winner:\n" + names);
  const p = players.find(x => x.name === winner);
  if (!p) return;
  p.stack += pot;
  pot = 0;
  nextHand();
}

function nextHand() {
  dealer = (dealer + 1) % players.length;
  startHand();
  render();
}

function resetSession() {
  if (!confirm("Reset entire session?")) return;
  players = [];
  pot = 0;
  dealer = 0;
  current = 0;
  highestBet = 0;
  streetIndex = 0;
  document.getElementById("players").innerHTML = "";
  document.getElementById("profit").innerHTML = "";
  render();
}

function render() {
  document.getElementById("street").textContent = streets[streetIndex];
  document.getElementById("pot").textContent = "Pot: $" + pot;
  const div = document.getElementById("players");
  div.innerHTML = "";

  players.forEach((p, i) => {
    let tags = "";
    if (i === dealer) tags += " <span class='badge'>D</span>";
    if (i === smallBlind()) tags += " <span class='badge'>SB</span>";
    if (i === bigBlind()) tags += " <span class='badge'>BB</span>";
    if (p.allIn) tags += " <span class='badge'>ALL-IN</span>";

    div.innerHTML += `
      <div class="player ${i===current?'active':''} ${p.folded?'folded':''}">
        <b>${p.name}</b>${tags}<br>
        Stack: $${p.stack} | Bet: $${p.bet}
        <div class="row">
          <button class="check" onclick="checkCall(${i})">Check/Call</button>
          <button class="raise" onclick="raiseBet(${i})">Raise</button>
          <button class="fold" onclick="fold(${i})">Fold</button>
        </div>
      </div>`;
  });

  renderProfit();
}

function renderProfit() {
  let html = "<h3>Session Profit</h3>";
  players.forEach(p => {
    const profit = p.stack - p.buyIn;
    html += `<div class="${profit>=0?'positive':'negative'}">
      ${p.name}: ${profit>=0?'+':''}$${profit}
    </div>`;
  });
  document.getElementById("profit").innerHTML = html;
}

render();
</script>

<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('sw.js');
}
</script>

</body>
</html>
